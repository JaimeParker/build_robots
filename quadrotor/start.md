# 飞行实验

## 软件在环仿真

## 硬件在环仿真

无人机上电后，Pixhawk4蜂鸣器会发出响声，以对应不同的工作状态。

可以参考PX4官网的声音对比，判断飞机的状态：

* [Tune Meanings (Pixhawk Series)](https://docs.px4.io/main/en/getting_started/tunes.html)
* [蜂鸣器含义（Pixhawk系列）](https://docs.px4.io/main/zh/getting_started/tunes.html)

对正常工作的声音和低电量声音应该比较敏感，能够分辨出来。

## 室内飞行测试

第一步，连接数传和地面站，校准磁罗盘，加速度计，电机（需要先断点，usb连飞控，再上电，直接开始校正）；

第二步，上桨叶，保证方向对且拧紧，人远离飞机；

第三步，开机，进入手动模式，但上锁；

第四步，解锁，电机进入怠速旋转；

第五步，定高模式，起飞；

第六步，切定点模式，观察定点飞行情况；

第七步，控制俯仰，偏航，滚转角，测试飞行情况；

第八步，降落，上锁，关电，拆桨叶；

## T265 定点飞行测试

将相机的里程计话题直接给`/mavros/odometry/out`，如果不稳，则考虑用飞控自己解算的姿态，一般位置是准的。

要确保飞控连接，之后确保`/mavros/local_position/pose`话题已经被飞控解算出，并且从QGC的MAVLink Inspector中看到的位置坐标比较稳定，才可以进行试飞。

## EGO-Planner 室内测试

[0721实验视频](https://www.bilibili.com/video/BV1rX4y1J7W7)

一些疑问：

* 在片段1中，在rviz中给出了2D Nav Goal，无人机也成功地绕开了障碍物，但是当离墙壁的距离十分近时，如果此时给出的Goal在obstacle内，planner不会使其继续向前运动，所以是定点的不稳定还是？一种可能是，防护网没有被D435识别成障碍物，其识别的是墙壁？
* 在片段2中，无人机前进时，围绕整个障碍物完成了建图，而返回时，为什么还会撞上障碍物？或者是偏航角速度太大，使得T265暂时跟丢？
* 在片段3中，offboard模式起飞过程中为什么变成了向前运动？
* 在片段4中，为什么planner最后到达的位置明显超过了2m（在x轴上）；我们后来做了无障碍物的实验，planner+t265定位，基本能飞到正确位置（但是也没法准确测量，没有位姿真值）
* 在片段5中，偏航角先是顺时针旋转，找到了可行域，之后向该方向有一个极小的位移，之后立刻改变偏航角，撞上障碍物；推测有可能是，在前期其没有认识到这是一个带厚度的墙壁，planner自动规划的航线就是改变偏航角后直接加速（这个小点在RAPTOR论文中解决了）；另一种可能是，4，5给的都是航路点信息，这不包含最终的偏航角信息，通过片段2中“绕大圈”的行为和片段5的行为对比，可以看出，给定偏航角的，其轨迹更长，但也更平滑，不给定偏航角，无人机更类似于一种全向机器人的运动规划。